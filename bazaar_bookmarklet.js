javascript:(()=>{const FORM=document.querySelector('form[method="post"][action^="https://eldersign.jp/bazaar"]');if(!FORM){alert("対象フォームが見つかりません");return;}const S=(n)=>FORM.querySelector(`select[name="${n}"]`);const FM=S("fm"),RR=S("rr"),ST=S("st"),DS=S("ds");if(!FM||!RR||!ST||!DS){alert("fm/rr/st/ds の select が見つかりません");return;}const Z=2147483647,KEY="__es_bazaar_ui_v3";const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));const load=()=>{try{return JSON.parse(localStorage.getItem(KEY)||"{}")}catch(e){return{}}};const save=(o)=>{try{localStorage.setItem(KEY,JSON.stringify(o))}catch(e){}};const st=load();const apply=(sel,val)=>{if(val==null)return;const v=String(val);if(sel.querySelector(`option[value="${CSS.escape(v)}"]`))sel.value=v;};apply(FM,st.fm);apply(RR,st.rr);apply(ST,st.st);apply(DS,st.ds);let W=Number(st.w)||440,H=Number(st.h)||960;W=clamp(W,320,Math.max(320,window.innerWidth-40));H=clamp(H,360,Math.max(360,window.innerHeight-40));const persist=()=>save({fm:FM.value,rr:RR.value,st:ST.value,ds:DS.value,w:W,h:H});const ensureStyle=()=>{if(document.getElementById("__es_chip_style"))return;const x=document.createElement("style");x.id="__es_chip_style";x.textContent=`#__es_chip_panel{font:12.5px/1.2 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}#__es_chip_panel .head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:4px}#__es_chip_panel .title{font-weight:800;font-size:12.5px}#__es_chip_panel .row{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin:4px 0 6px}#__es_chip_panel .ttl{font-weight:700;font-size:11px;color:#333;margin-right:2px}#__es_chip_panel input[type=radio]{position:absolute;opacity:0;pointer-events:none}#__es_chip_panel label.chip{display:inline-flex;align-items:center;padding:5px 8px;border-radius:999px;border:1px solid rgba(0,0,0,.22);background:#fff;cursor:pointer;transition:.15s}#__es_chip_panel label.chip:hover{box-shadow:0 4px 10px rgba(0,0,0,.12)}#__es_chip_panel input:checked+label.chip{background:#111;color:#fff;border-color:#111}#__es_chip_panel button{all:unset;cursor:pointer;padding:5px 9px;border-radius:999px;border:1px solid rgba(0,0,0,.2);background:#fff;font-weight:700}#__es_chip_panel button:hover{box-shadow:0 4px 10px rgba(0,0,0,.12)}#__es_chip_panel .hint{font-size:10.5px;color:#555;margin-top:2px}`;document.head.appendChild(x);};ensureStyle();let ifr=document.getElementById("__es_post_iframe");if(!ifr){ifr=document.createElement("iframe");ifr.id="__es_post_iframe";ifr.name="__es_post_iframe";ifr.style.cssText=`position:fixed;right:10px;bottom:10px;z-index:${Z};background:#fff;border:1px solid rgba(0,0,0,.25);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.28);overflow:hidden`;document.body.appendChild(ifr);}let panel=document.getElementById("__es_chip_panel");if(!panel){panel=document.createElement("div");panel.id="__es_chip_panel";panel.style.cssText=`position:fixed;right:10px;z-index:${Z};background:rgba(255,255,255,.96);backdrop-filter:saturate(1.2) blur(6px);border:1px solid rgba(0,0,0,.18);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.18);padding:8px 8px 6px;color:#111`;document.body.appendChild(panel);}const layout=()=>{W=clamp(W,320,Math.max(320,window.innerWidth-40));H=clamp(H,360,Math.max(360,window.innerHeight-40));ifr.style.width=W+"px";ifr.style.height=H+"px";panel.style.width=W+"px";panel.style.bottom=(H+14)+"px";persist();};layout();window.addEventListener("resize",layout,{passive:true});const optList=(sel)=>Array.from(sel.options).map(o=>({v:o.value,t:(o.textContent||"").trim()}));const mkGroup=(name,title,opts,val,on)=>{const d=document.createElement("div");d.className="row";const t=document.createElement("div");t.className="ttl";t.textContent=title;d.appendChild(t);opts.forEach((o,i)=>{const id=`${name}_${i}_${Math.random().toString(36).slice(2,6)}`;const r=document.createElement("input");r.type="radio";r.name=name;r.id=id;r.value=o.v;r.checked=String(o.v)===String(val);r.onchange=()=>{if(r.checked)on(o.v)};const l=document.createElement("label");l.className="chip";l.htmlFor=id;l.textContent=o.t;d.appendChild(r);d.appendChild(l);});return d;};const submit=(()=>{let t;return()=>{clearTimeout(t);t=setTimeout(()=>{FORM.setAttribute("target","__es_post_iframe");FORM.submit();},80);};})();const dsLimited=(()=>{const wanted=["-1","99"];return optList(DS).filter(o=>wanted.includes(String(o.v)));})();panel.innerHTML="";const head=document.createElement("div");head.className="head";const ttl=document.createElement("div");ttl.className="title";ttl.textContent="Eldersign 検索（Chips）";const btns=document.createElement("div");btns.style.display="flex";btns.style.gap="6px";const b1=document.createElement("button");b1.textContent="検索";b1.onclick=()=>submit();const b2=document.createElement("button");b2.textContent="閉じる";b2.onclick=()=>{panel.remove();try{document.getElementById("__es_chip_style")?.remove()}catch(e){}};btns.appendChild(b1);btns.appendChild(b2);head.appendChild(ttl);head.appendChild(btns);panel.appendChild(head);panel.appendChild(mkGroup("es_fm","ファミリー",optList(FM),FM.value,v=>{FM.value=v;persist();submit();}));panel.appendChild(mkGroup("es_rr","レアリティ",optList(RR),RR.value,v=>{RR.value=v;persist();submit();}));panel.appendChild(mkGroup("es_st","条件",optList(ST),ST.value,v=>{ST.value=v;persist();submit();}));panel.appendChild(mkGroup("es_ds","表示ステータス",dsLimited,DS.value,v=>{DS.value=v;persist();submit();}));const hint=document.createElement("div");hint.className="hint";hint.textContent="※ 起動時に初回検索を実行します（以後、変更で自動POST）";panel.appendChild(hint);FORM.setAttribute("target","__es_post_iframe");persist();submit();})();